<!DOCTYPE html>
<html> 

<head>
	
	 <meta name="viewport" content="width=device-width, initial-scale=1">
	
	 <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

	

	
    <style>
        #map {
            width: 100%;                        /* Google maps */
            height: 300px;
        }
        
        .map-wrapper {
            margin-top: 160px;
		}
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?sensor=false">
        // Google maps v3
    </script>
    <script>
		$(function(){
           countMap = 3;  // To get 4 search results per page 
           responseJson="";
        });
		 function initialize() {
			
            var stylers = [{
                "stylers": [{
                        "visibility": "simplified"
                        },
                    {
                        "saturation": 20
                        },
                    {
                        "weight": 3.2
                        },
                    {
                        "lightness": 25
                        }]
    }]

            var mapCanvas = document.getElementById('map');
            var mapOptions = {
               center: new google.maps.LatLng(44.8368, -93.4008),
               // center: new google.maps.LatLng(23,-36),
                zoom: 9,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                styles: stylers
				
            }
             map = new google.maps.Map(mapCanvas, mapOptions);
			 
        } 
 google.maps.event.addDomListener(window, 'load', initialize);
	
    </script>
</head>

<body>
     <!--/*StoreWrap*/-->
   

  <div class="storeLocatorWrapper">
	  <div class="large-8 medium-8 columns">
	    <div style="padding-bottom: 0px"> <span class="head-underline">STORE LOCATOR</span>
			<p  id="store-twoPages">Use your local zip code or current address to find SUPERVALU stores and independent grocers near you and experience Culinary Circle tonight.</p>
			
        </div>
        
	  </div>
    <div class="storeWrap" >
        <div class="row store-locator">

            <div class="large-8 medium-8 columns">
                <div class="row" >
                    <div class="large-7 large-push-5 medium columns">
                        
                        <div>
                            <input  class="non-req street" type="text"   placeholder="Street Address" />
                        </div>
                        <div class="row">
                            <!--Select city-->
                            <div class="large-6  small-6 columns">
                                <input class="non-req no-paddin-left city" type="text" placeholder="City"  />
                            </div>
                            <div  class="large-6  small-6 columns no-paddin-left">
                                <!--State select-->
                                <select class="selectBox no-paddin-left selectState" >
                                    <option value="">State</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <option value="CO">Colorado</option>
                                    <option value="CT">Connecticut</option>
                                    <option value="DE">Delaware</option>
                                    <option value="DC">District Of Columbia</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="HI">Hawaii</option>
                                    <option value="ID">Idaho</option>
                                    <option value="IL">Illinois</option>
                                    <option value="IN">Indiana</option>
                                    <option value="IA">Iowa</option>
                                    <option value="KS">Kansas</option>
                                    <option value="KY">Kentucky</option>
                                    <option value="LA">Louisiana</option>
                                    <option value="ME">Maine</option>
                                    <option value="MD">Maryland</option>
                                    <option value="MA">Massachusetts</option>
                                    <option value="MI">Michigan</option>
                                    <option value="MN">Minnesota</option>
                                    <option value="MS">Mississippi</option>
                                    <option value="MO">Missouri</option>
                                    <option value="MT">Montana</option>
                                    <option value="NE">Nebraska</option>
                                    <option value="NV">Nevada</option>
                                    <option value="NH">New Hampshire</option>
                                    <option value="NJ">New Jersey</option>
                                    <option value="NM">New Mexico</option>
                                    <option value="NY">New York</option>
                                    <option value="NC">North Carolina</option>
                                    <option value="ND">North Dakota</option>
                                    <option value="OH">Ohio</option>
                                    <option value="OK">Oklahoma</option>
                                    <option value="OR">Oregon</option>
                                    <option value="PA">Pennsylvania</option>
                                    <option value="RI">Rhode Island</option>
                                    <option value="SC">South Carolina</option>
                                    <option value="SD">South Dakota</option>
                                    <option value="TN">Tennessee</option>
                                    <option value="TX">Texas</option>
                                    <option value="UT">Utah</option>
                                    <option value="VT">Vermont</option>
                                    <option value="VA">Virginia</option>
                                    <option value="WA">Washington</option>
                                    <option value="WV">West Virginia</option>
                                    <option value="WI">Wisconsin</option>
                                    <option value="WY">Wyoming</option>
                                </select>

                            </div>
                        </div>
                    </div>
                    <div class="large-2 large-pull-4 columns">
                        <img class="store-or" src='\etc\designs\privatebrands\culinarycircle\clientlib-site\images\common\deskor.png' alt="OR"></div>
                    
                    <div class="large-2 large-pull-4 columns">
                        <img class="mobile"src='\etc\designs\privatebrands\culinarycircle\clientlib-site\images\common\deskorModified.png' alt="ORModified"></div>

                    <div class="large-3 large-pull-9 small-12 columns">
                        <input class="non-req zip" type="text" placeholder="Zipcode" name="zip" > </div>
               </div> 

                <hr style="border-top: dotted 1px;">
                <div class="row">
                    <div class="large-6 columns">
                        <h4>OPTIONAL</h4>
                        <p>Search within this radius</p>

                        <select id="radius" class="selectBox"   >   
                         
                            <option value="10" >10 Miles</option>
                            <option value="20">20 Miles</option>
                            <option value="50">50 Miles</option>
                        </select>

                    </div>
                    <div class="large-6 columns">
                        <button id="locationsearch" class="location-search">SEARCH LOCATIONS</button>
                    </div>
                </div>
                
            </div>

            <div class="large-4 medium-8 columns hide-for-small-only" style="height:40px;">
                <img class="center-display" src='\etc\designs\privatebrands\culinarycircle\clientlib-site\images\common\logos.png' alt="logos">
            </div>
        </div>
    </div>

    <div class="row mapCanvas mapPositionCanvas">
    <div class="small-12 medium-12 large-8 columns"> 
			
        <div id="map" >
		
		</div>
		 <ul class="store-results"> </ul>    
	
           <p href="#"  class="new-search">NEW SEARCH</p>
    
    </div>
    
    <div class="large-4 medium-8 columns hide-for-small-only" style="height:40px">
        <img class="center-display-maps" src='\etc\designs\privatebrands\culinarycircle\clientlib-site\images\common\logos.png' alt="logos">
    </div>
   
     </div> 
    </div>
</body>
<script>
    //-------------------------------------------------
//		Quick Pager jquery plugin
//		Created by dan and emanuel @geckonm.com
//		www.geckonewmedia.com
// 
//
//		18/09/09 * bug fix by John V - http://blog.geekyjohn.com/
//		1.2 - allows reloading of pager with new items
//-------------------------------------------------

(function($) {
	    
	$.fn.quickPager = function(options) {
	
		var defaults = {
			pageSize: 10,
			currentPage: 1,
			holder: null,
			pagerLocation: "after",
            totalCount : 0
		};
		
		var options = $.extend(defaults, options);
		
		
		return this.each(function() {
	
						
			var selector = $(this);	
			var pageCounter = 1;
			
			selector.wrap("<div class='simplePagerContainer'></div>");
			
			selector.parents(".simplePagerContainer").find("ul.simplePagerNav").remove();
			
			selector.children().each(function(i){ 
				
                if(i < selector.children().length){
				if(i < pageCounter*options.pageSize && i >= (pageCounter-1)*options.pageSize) {
				$(this).addClass("simplePagerPage"+pageCounter);
				}
				else {
					$(this).addClass("simplePagerPage"+(pageCounter+1));
					pageCounter ++;
				}	
                }
				
			});
			
			// show/hide the appropriate regions 
			selector.children().hide();
			selector.children(".simplePagerPage"+options.currentPage).show();
			
			if(pageCounter <= 1) {
				return;
			}
			
			//Build pager navigation
			var pageNav = "<ul class='simplePagerNav'>";
			
            options.totalCount = ($(this).children().length);
			    pageNav += "<li class='textNav'><span class='currentPage'> "+options.currentPage+" </span>through<span class='NumOfLi'> "+options.pageSize+" </span>of<span class='totalLi'> "+  options.totalCount +" </span>stores</li>";
			for (i=1;i<=pageCounter;i++){
				if (i==options.currentPage) {
					pageNav += "<li class='currentPage simplePageNav"+i+"'><a rel='"+i+"' href='#'>"+i+"</a></li>";	
				}
				else {
					pageNav += "<li class='simplePageNav"+i+"'><a rel='"+i+"' href='#'>"+i+"</a></li>";
				}
            
			}
			pageNav += "</ul>";
			
			if(!options.holder) {
				switch(options.pagerLocation)
				{
				case "before":
					selector.before(pageNav);
				break;
				case "both":
					selector.before(pageNav);
					selector.after(pageNav);
				break;
				default:
					selector.after(pageNav);
				}
			}
			else {
				$(options.holder).append(pageNav);
			}
			
			//pager navigation behaviour
			selector.parent().find(".simplePagerNav a").click(function() {
				
					
				//grab the REL attribute 
				var clickedLink = $(this).attr("rel"), currentPage , numberOfLi;
				options.currentPage = clickedLink;
				
				if(options.holder) {
					$(this).parent("li").parent("ul").parent(options.holder).find("li.currentPage").removeClass("currentPage");
					$(this).parent("li").parent("ul").parent(options.holder).find("a[rel='"+clickedLink+"']").parent("li").addClass("currentPage");
				}
				else {
					//remove current current (!) page
					$(this).parent("li").parent("ul").parent(".simplePagerContainer").find("li.currentPage").removeClass("currentPage");
					//Add current page highlighting
					$(this).parent("li").parent("ul").parent(".simplePagerContainer").find("a[rel='"+clickedLink+"']").parent("li").addClass("currentPage");
				}
				
				//hide and show relevant links
				selector.children().hide();			
				selector.find(".simplePagerPage"+clickedLink).show();
				var listArray = selector.find('li'),
				    listArray = listArray.filter(".simplePagerPage"+clickedLink);
				 currentPage = 	listArray.index() + 1;
				 numberOfLi =   listArray.last().index() + 1;
				 selector.parent().find(".simplePagerNav .textNav").find('.currentPage').html(' '+currentPage+' ');
				 selector.parent().find(".simplePagerNav .textNav").find('.NumOfLi').html(' '+numberOfLi+' ');
				return false;
								
				});
		
			});
	}
	
})(jQuery);



</script>
<script>
     
        // Function gets called once the user clicks on Search Locations button 
function submitLocationSearchForm(){
   var zipCodeValue = $.trim($(".zip").val()),
	   cityValue = $.trim($(".city").val()),
	   stateValue = $.trim($(".selectState").val()),
       streetValue = $.trim($(".street").val()),
	   radiusValue = $.trim($('#radius').val()),
	   brandId="4",
	   
	   dataObj ={
		 zipCode: zipCodeValue,
		 city: cityValue,
		 state: stateValue,
		 radius: radiusValue,
		 brandId: "4",
		 
	   };
	
	// Call to the back-end 
	
     $.ajax({
                type: 'POST',
                cache: false,
                url: '/services/searchStores.json',
                data: {brandId:'4',zipCode:zipCodeValue,city: cityValue,state: stateValue,street:streetValue,radius: radiusValue},
		 

                success: function (data) {
                   
                    $('.storeWrap').hide();
			$('.mapCanvas').removeClass('mapPositionCanvas');
			jsonTraversing(data);
					
	
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("An error has occurred while retriving locations, Please try again."+jqXHR);
                }
            
            });
	
}
	
	
        $(".location-search").click(function () {
            console.log("search location button clicked");
            if (validateInput()) {
               submitLocationSearchForm(); 
            } else {
                return false;
            }
			
        });
       $('.new-search').click(function(e){
		   e.preventDefault();
		   $('.mapCanvas').addClass('mapPositionCanvas');
		   $('.storeWrap').show();
	   })
        
	   // Validating the given inputs
	   function validateInput() {
            var zipCodeValue = $(".zip").val();
            var cityValue = $(".city").val();
            var stateValue = $(".selectState").val();
            var returnValue = false;

            zipCodeValue = zipCodeValue.replace(/ /g, "");
            cityValue = cityValue.replace(/ /g, "");
            stateValue = stateValue.replace(/ /g, "");

            if (zipCodeValue.length == 0 && (cityValue.length == 0 && stateValue.length == 0)) {
                alert("Please enter a zip code or city/state");
                zipCodeValue.value = "";
                zipCodeValue.focus();
            } else if (zipCodeValue.length == 0 && (cityValue.length > 0 && stateValue.length == 0)) {
                alert("Please select a state");
                stateValue.focus();
            } else if (zipCodeValue.length == 0 && (cityValue.length == 0 && stateValue.length > 0)) {
                alert("Please enter a city");
                cityValue.value = "";
                cityValue.focus();
            } else if (zipCodeValue.length > 0 && !isNumeric(zipCodeValue)) {
                alert("Please enter a numeric value for zip code");
                zipCodeValue.value = "";
                zipCodeValue.focus();
            } else {
                returnValue = true;
            }

            return returnValue;
        }

        function isNumeric(zipCode) {
            var isNumeric = true;
            var chars = "~`!@#$%^&*()_-+={[}]|\\:;\"'<,>.?/abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
            var charArray = chars.split("");

            for (var i = 0; i < charArray.length; i++) {
                if (zipCode.indexOf(charArray[i]) != -1) {
                    isNumeric = false;
                }
            }

            return isNumeric;
        }
	
	// If the JSON data is successful, it would come here.
		function jsonTraversing(data){
			console.log('function jsonTraversing called');
            responseJson=JSON.parse(data);
            templateLi = "";
            marker = "";
            markersArray = [];
			
			responseJson = responseJson.storeList;
            
			console.log('Store data ',responseJson);

			var infowindow = new google.maps.InfoWindow();
            //pagination
            var responseCount = 0;
            console.log(responseJson.length);
            for(i=0;i< responseJson.length;i++){
                var useAplhabets ='';			
	var start_letter_code = useAplhabets ? 97 : 1;
    var marker_color = "DBAB15";
    var marker_text_color = "FFFFFF";
         var responseId = responseCount + 1;
                console.log(responseJson[i]);
                
				templateLi += "<li class=''><span class='markerMap'>"+responseId+"</span><p class='storeName'>"+responseJson[i]['storeName']+"(CID "+responseJson[i]['storeId']+")"+"<span class='distance'>"+responseJson[i]['distance']+" miles</span></p><p class='address'>"+responseJson[i]['address1']+", "+responseJson[i]['city']+", "+responseJson[i]['state']+' '+responseJson[i]['zipCode']+"<p class='phone'><span>Phone:</span> "+responseJson[i]['storePhone']+"</p></li>";
           responseCount++;
                
            
            }
            //applying jQuery pager plugin
            $('ul.store-results').append(templateLi);
            console.log(templateLi);
			
			$("ul.store-results").quickPager({pagerLocation:"before",pageSize:"4"});

            //mapping
      reload();
      function reload(){
                //clears the google map previous markers
               
                  for(i=0;i<markersArray.length;i++){
                      markersArray[i].setMap(null);
                             }  
               
                   console.log('check the testmarker',markersArray.length);
                
                //clear map ends
                   var test = [];
                   maxCounts = 4;
                   j=0;
                   for(var i = (countMap-3); j< maxCounts; j++){
                    test.push(responseJson[i]);
                    i++;
                     }
                  responseJsonNew = test;
             
                  console.log(responseJsonNew);
                   var startCount = countMap - 2;
             
			      for(var i in responseJsonNew){
				
				
                     /* Added for Google Maps Markers Numbering */	
    
	               var useAplhabets ='';			
	               var start_letter_code = useAplhabets ? 97 : 1;
                   var marker_color = "DBAB15";
                   var marker_text_color = "FFFFFF";

				
				    marker = new google.maps.Marker({
					
					position: new google.maps.LatLng(responseJsonNew[i]['latitude'], responseJsonNew[i]['longitude']),
					map: map,
                    // icon:'/etc/designs/privatebrands/culinarycircle/clientlib-site/images/common/pin_maps.png'
					
					icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=" + startCount + "|" +          marker_color + "|" + marker_text_color
					
					}) 
		
			
                 markersArray.push(marker)
				 
				 
				 var markerContent  = "<p><p class='markerStore'>"+responseJsonNew[i]['storeName']+"</p><p class='markerStoreAddr'>"+responseJsonNew[i]['address1']+" "+responseJsonNew[i]['city']+" "+responseJsonNew[i]['state']+"</p></p>"
				 google.maps.event.addListener(marker, 'click', (function(marker, i,markerContent) {
						return function() {
						  infowindow.setContent(markerContent);
						  infowindow.open(map, marker);
						}
				  })(marker, i,markerContent));
				  if(i == 0){
				  map.setCenter(new google.maps.LatLng(responseJsonNew[i]['latitude'], responseJsonNew[i]['longitude']));
				  }
				startCount++;
                }  
            }
           
            
			
			
			/*$('ul.store-results').find('li .storeName').each(function(i){
				 $(this).click(function(){
                    
					google.maps.event.trigger(markersArray[i], 'click');
				
				 })
			}) */
			
			
		// OnClick of the pagination results , the countMap should change which effects maps 
			$('ul.simplePagerNav').find('li a').each(function(i){
				
				
				//marker 
				 $(this).click(function()
							   {
                     console.log(this);
                     var pagenumber = this.text;
                     console.log(pagenumber);
			        countMap =  (pagenumber*4)-1;
					 //marker
                     reload();
				 			}		          
							    )
			})
	
            

		}
			
</script>
</html>